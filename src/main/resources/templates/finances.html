<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link th:href="@{/resources/css/navbar.css}" rel="stylesheet"/>
    <link th:href="@{/resources/css/finances.css}" rel="stylesheet"/>

    <title>Finances page</title>
</head>
<body>
<div class="container-fluid">
    <div class="row ">
        <!-- Navbar -->
        <div class="col" th:replace="~{navbar}"></div>

        <!-- Main Content -->
        <div class="col d-flex flex-column align-items-center justify-items-center p-4" style="position: relative;">
            <!-- Isolated Absolute Element -->
            <div class="position-absolute" style="top: 10px; right: 20px;">
                <div class="d-flex align-items-center">
                    <label class="mr-2" th:text="${todayDate}"></label>
                    <form th:action="@{/toggleState}" th:method="post">
                        <button type="submit" class="btn btn-primary btn-sm"
                                th:if="${shopOpened}" th:text="#{finances.day.end}"></button>
                        <button type="submit" class="btn btn-primary btn-sm"
                                th:if="${shopOpened == null ? true : !shopOpened}"
                                th:text="#{finances.day.start}"></button>
                    </form>
                </div>
            </div>

            <!-- Main Title -->
            <div class="row">
                <h2 th:text="#{finances.title}">Transactions History</h2>
            </div>

            <div class="row d-flex flex-column justify-content-center mb-4">
                <div class="row d-flex align-items-center mb-3">
                    <form class="d-flex flex-row align-items-center mx-2" th:method="get" th:action="@{/filterDates}">
                        <p class="mb-0 mx-2" th:text="#{finances.from}"></p>
                        <input type="date" name="date1" th:value="${date1}" required class="form-control mx-2" style="max-width: 150px;"/>
                        <p class="mb-0 mx-2" th:text="#{finances.until}"></p>
                        <input type="date" name="date2" th:value="${date2}" required class="form-control mx-2" style="max-width: 150px;"/>
                        <button class="btn btn-primary mx-2" th:text="#{finances.filter.button.set}"></button>
                    </form>
                    <form class="mx-2" th:method="get" th:action="@{/resetDates}">
                        <button class="btn btn-secondary" th:text="#{finances.filter.button.reset}"></button>
                    </form>
                </div>

                <div class="row d-flex align-items-center gap-3 mb-3">
                    <form class="d-flex flex-row align-items-center mx-2" th:method="get" th:action="@{/filterCategories}">
                        <select name="filter" id="filter" th:value="${category}" class="form-select mx-2" style="max-width: 200px;">
                            <option value="all" th:text="#{finances.filter.everything}" th:selected="${category}=='all'"></option>
                            <option value="income" th:text="#{finances.filter.income}" th:selected="${category}=='income'"></option>
                            <option value="spendings" th:text="#{finances.filter.spendings}" th:selected="${category}=='spendings'"></option>
                            <option value="simple order" th:text="#{finances.filter.simple}" th:selected="${category}=='simple order'"></option>
                            <option value="reserved order" th:text="#{finances.filter.reserved}" th:selected="${category}=='reserved order'"></option>
                            <option value="event order" th:text="#{finances.filter.event}" th:selected="${category}=='event order'"></option>
                            <option value="contract order" th:text="#{finances.filter.contract}" th:selected="${category}=='contract order'"></option>
                            <option value="wholesaler" th:text="#{finances.filter.wholesaler}" th:selected="${category}=='wholesaler'"></option>
                        </select>
                        <button class="btn btn-primary mx-2" th:text="#{finances.filter.button.set}"></button>
                    </form>
                    <form class="mx-2" th:method="get" th:action="@{/resetCategory}">
                        <button class="btn btn-secondary" th:text="#{finances.filter.button.reset}"></button>
                    </form>
                </div>

                <div class="row d-flex align-items-center gap-3 mb-3">
                    <form class="d-flex flex-row align-items-center mx-2" th:method="get" th:action="@{/filterCustomerName}">
                        <p class="mb-0 mx-2" th:text="#{finances.filter.customerName}"></p>
                        <input type="text" name="customerName" th:value="${customerName}" required class="form-control mx-2" style="max-width: 200px;"/>
                        <button class="btn btn-primary mx-2" th:text="#{finances.filter.button.set}"></button>
                    </form>
                    <form class="mx-2" th:method="get" th:action="@{/resetCustomerName}">
                        <button class="btn btn-secondary" th:text="#{finances.filter.button.reset}"></button>
                    </form>
                </div>

                <div class="row d-flex align-items-center gap-3">
                    <form class="d-flex flex-row align-items-center mx-2" th:method="get" th:action="@{/filterTransactionValue}">
                        <p class="mb-0 mx-2" th:text="#{finances.filter.transactionValue}"></p>
                        <input type="number" name="transactionValue" th:value="${transactionValue}" step="0.01" required class="form-control mx-2" style="max-width: 150px;"/>
                        <button class="btn btn-primary mx-2" th:text="#{finances.filter.button.set}"></button>
                    </form>
                    <form class="mx-2" th:method="get" th:action="@{/resetTransactionValue}">
                        <button class="btn btn-secondary" th:text="#{finances.filter.button.reset}"></button>
                    </form>
                </div>
            </div>

            <div class="row w-100 mt-4">
                <!--                    To do: Make h variable-->
                <div class="table-responsive" style="max-height: calc(60vh); overflow-y: auto;">
                    <table class="table table-striped w-100 text-center" id="finances-table">
                        <thead>
                        <div class="table-header">
                            <tr>
                                <th
                                        colspan="5"
                                        style="text-align: left"
                                        th:text="#{finances.table.head.balance}"
                                >
                                    Current Balance:
                                </th>
                                <th th:text="${currentBalance}"></th>
                            </tr>
                            <tr>
                                <th
                                        colspan="5"
                                        style="text-align: left"
                                        th:text="#{finances.table.head.saldo} + ' ' + ${todayDate}"
                                >
                                    Day profit
                                </th>
                                <th th:text="${dayProfit}"></th>
                            </tr>
                            <tr th:if="${transactionsNotEmpty}">
                                <th th:text="#{finances.table.head.timestamp}"></th>
                                <th th:text="#{finances.table.head.category}"></th>
                                <th th:text="#{finances.table.head.client}"></th>
                                <th th:text="#{finances.table.head.item}"></th>
                                <th th:text="#{finances.table.head.quantity}"></th>
                                <th th:text="#{finances.table.head.value}"></th>
                            </tr>
                        </div>
                        </thead>
                        <tbody>
                        <tr></tr>
                        <tr th:each="order : ${transactions}">
                            <td th:text="${order.timestampStr}"></td>

                            <td
                                    th:text="${order.category}"
                                    th:classappend="${order.category.equals('Einkauf') ? 'text-danger' : 'text-success'}"
                            ></td>
                            <td th:text="${order.clientName}"></td>
                            <td>
                                <ul>
                                    <li
                                            th:each="entry : ${order.items}"
                                            th:text="${entry.key}"
                                    ></li>
                                </ul>
                            </td>
                            <td>
                                <ul>
                                    <li
                                            th:each="entry : ${order.items}"
                                            th:text="${entry.value}"
                                    ></li>
                                </ul>
                            </td>
                            <td th:text="${order.value}"></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="row w-100 mt-4">
                <!--                    To do: Make h variable-->
                <div class="table-responsive" style="max-height: calc(60vh); overflow-y: auto;">
                    <h3 th:text="#{finances.anotherTable.title}"></h3>
                    <table class="table table-striped w-100 text-center" id="deleted-table">
                        <thead>
                            <tr th:if="${deletedProductsNotEmpty}">
                                <th th:text="#{finances.anotherTable.head.date}"></th>
                                <th th:text="#{finances.anotherTable.head.name}">Name</th>
                                <th th:text="#{finances.anotherTable.head.price}">Price per Unit</th>
                                <th th:text="#{finances.anotherTable.head.quantity}">Quantity Deleted</th>
                                <th th:text="#{finances.anotherTable.head.loss}">Total Loss</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="deletedProduct : ${deletedProducts}">
                                <td th:text="${deletedProduct.dateWhenDeleted}"></td>
                                <td th:text="${deletedProduct.name}"></td>
                                <td th:text="${deletedProduct.pricePerUnit}"></td>
                                <td th:text="${deletedProduct.quantityDeleted}"></td>
                                <td th:text="${deletedProduct.totalLoss}"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="table-header">
                <div class="row w-100 d-flex justify-content-center mt-3">

                    <a class="btn btn-primary" th:href="@{/askForDay}" th:text="#{finances.dailyReport}"></a>
                    <a class="btn btn-primary" th:href="@{/askForMonth}" th:text="#{finances.monthlyReport}"></a>
                </div>

            </div>
        </div>
    </div>
</div>
</body>
</html>
